20230406_binary_model_wide

10000000 train


```
    def _observe(self):
        # 1 レースを取得し、observe 化 (20 行固定) する。
        self._race = self._groups[self._steps]
        self._race.reset_index(inplace=True, drop=True)
        #padding_df = self._race.reindex(range(5), fill_value=-1)
        padding_df = self._race[["odds", "pred"]].reindex(range(20), fill_value=-1)
        #print(padding_df.values.tolist())
        return padding_df.values.tolist()


try:
    model = keras.models.load_model('./../model/binary_model_wide')
except:
    print("create")
    # Kerasを使ってモデルを作成します。
    model = keras.models.Sequential([
        keras.layers.Flatten(input_shape=(1,) + env.observation_space.shape),
        keras.layers.Dense(128, activation="elu"),
        keras.layers.Dense(128, activation='elu'),
        keras.layers.BatchNormalization(),
        keras.layers.Dense(128, activation='elu'),
        keras.layers.Dense(128, activation='elu'),
        keras.layers.Dropout(0.3),
        keras.layers.Dense(nb_actions, activation="linear"),
    ])

model.summary()
    
# 経験値を蓄積するためのメモリです。学習を安定させるために使用します。
memory = SequentialMemory(limit=50000, window_length=1)

# 行動ポリシーはBoltzmannQPolicyを使用しています。
# EpsGreedyQPolicyと比較して、こちらの方が収束が早かったので採用しています。
policy = EpsGreedyQPolicy()

# DQNAgentを作成します。
dqn = DQNAgent(
    model=model,
    nb_actions=nb_actions,
    memory=memory,
    target_model_update=1e-2,
    policy=policy)

# DQNAgentのコンパイル。最適化はAdam,評価関数はMAEを使用します。
dqn.compile(Adam(learning_rate=1e-4), metrics=[
    keras.losses.BinaryCrossentropy(from_logits=True, name='binary_crossentropy'), 'accuracy'
])

# 学習開始
history = dqn.fit(env, nb_steps=10000000, visualize=False, log_interval=34462, verbose=1)


Model: "sequential"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 flatten (Flatten)           (None, 40)                0         
                                                                 
 dense (Dense)               (None, 128)               5248      
                                                                 
 dense_1 (Dense)             (None, 128)               16512     
                                                                 
 batch_normalization (BatchN  (None, 128)              512       
 ormalization)                                                   
                                                                 
 dense_2 (Dense)             (None, 128)               16512     
                                                                 
 dense_3 (Dense)             (None, 128)               16512     
                                                                 
 dropout (Dropout)           (None, 128)               0         
                                                                 
 dense_4 (Dense)             (None, 11)                1419      
                                                                 
=================================================================
Total params: 56,715
Trainable params: 56,459
Non-trainable params: 256

[-4418.0, -1600.0, -1368.0, -1258.0, -880.0, -1088.0, -840.0, -868.0, -768.0, -760.0, -750.0, -604.0, -464.0, -458.0, -402.0, -480.0, -244.0, -158.0, -164.0, 24.0, -230.0, 84.0, 8.0, 114.0, 72.0, 38.0, 16.0, 232.0, 164.0, 332.0, 344.0, 406.0, 448.0, 454.0, 586.0, 584.0, 444.0, 766.0, 740.0, 726.0, 1032.0, 970.0, 896.0, 800.0, 948.0, 1060.0, 1014.0, 822.0, 1212.0, 964.0, 1252.0, 1188.0, 1074.0, 1324.0, 1264.0, 1118.0, 1436.0, 1320.0, 1376.0, 1340.0, 1642.0, 1664.0, 1440.0, 1644.0, 1516.0, 1726.0, 1780.0, 1668.0, 1708.0, 1706.0, 1704.0, 1834.0, 1902.0, 1938.0, 1926.0, 1902.0, 2096.0, 1996.0, 2330.0, 2240.0, 2094.0, 2004.0, 2094.0, 2040.0, 2000.0, 2216.0, 2264.0, 2298.0, 2268.0, 2396.0, 2442.0, 2274.0, 2236.0, 2412.0, 2424.0, 2478.0, 2370.0, 2146.0, 2526.0, 2558.0, 2302.0, 2466.0, 2374.0, 2594.0, 2516.0, 2406.0, 2418.0, 2326.0, 2276.0, 2442.0, 2414.0, 2292.0, 2608.0, 2356.0, 2500.0, 2546.0, 2446.0, 2506.0, 2704.0, 2594.0, 2570.0, 2612.0, 2614.0, 2752.0, 2796.0, 2898.0, 2744.0, 2638.0, 2704.0, 2810.0, 2558.0, 2710.0, 2516.0, 3014.0, 2988.0, 2796.0, 2822.0, 2884.0, 2796.0, 2870.0, 2728.0, 2882.0, 2844.0, 2852.0, 2950.0, 2918.0, 3102.0, 2944.0, 3084.0, 3072.0, 2934.0, 2928.0, 3058.0, 2896.0, 2924.0, 2884.0, 3086.0, 2882.0, 2868.0, 2872.0, 3010.0, 3006.0, 3208.0, 3268.0, 3080.0, 3200.0, 3166.0, 3220.0, 3086.0, 3034.0, 3046.0, 3150.0, 3202.0, 3080.0, 3340.0, 3128.0, 3252.0, 2972.0, 3042.0, 3236.0, 3146.0, 3236.0, 3022.0, 3258.0, 3254.0, 2988.0, 3442.0, 3314.0, 3476.0, 3302.0, 3472.0, 3280.0, 3264.0, 3442.0, 3132.0, 2984.0, 3088.0, 3250.0, 3236.0, 3344.0, 3340.0, 3412.0, 3376.0, 3370.0, 3192.0, 3462.0, 3302.0, 3366.0, 3324.0, 3322.0, 3188.0, 3338.0, 3320.0, 3350.0, 3420.0, 3520.0, 3322.0, 3412.0, 3470.0, 3546.0, 3396.0, 3568.0, 3520.0, 3292.0, 3362.0, 3438.0, 3370.0, 3506.0, 3398.0, 3426.0, 3524.0, 3514.0, 3348.0, 3446.0, 3486.0, 3430.0, 3520.0, 3420.0, 3474.0, 3464.0, 3518.0, 3430.0, 3516.0, 3584.0, 3514.0, 3326.0, 3540.0, 3460.0, 3322.0, 3296.0, 3510.0, 3652.0, 3404.0, 3410.0, 3616.0, 3580.0, 3466.0, 3524.0, 3860.0, 3518.0, 3586.0, 3532.0, 3596.0, 3588.0, 3656.0, 3494.0, 3566.0, 3630.0, 3606.0, 3610.0, 3418.0, 3570.0, 3454.0, 3678.0, 3648.0, 3580.0, 3568.0, 3630.0, 3666.0, 3496.0, 3560.0, 3780.0, 3676.0, 3696.0, 3574.0, 3678.0, 3536.0, 3772.0, 3690.0, 3648.0]
```

<br><br>

* 2013 予想

```
RANK_ONE_TWO_HORSE 回数: 195
RANK_ONE_THREE_HORSE 回数: 151
RANK_ONE_FOUR_HORSE 回数: 111
RANK_ONE_FIVE_HORSE 回数: 99
RANK_TWO_THREE_HORSE 回数: 153
RANK_TWO_FOUR_HORSE 回数: 90
RANK_TWO_FIVE_HORSE 回数: 74
RANK_THREE_FOUR_HORSE 回数: 72
RANK_THREE_FIVE_HORSE 回数: 84
RANK_FOUR_FIVE_HORSE 回数: 26
未購入回数: 2399

当たり馬券: 252
はずれ馬券: 803
的中率: 0.23886255924170616

当たり金額: 769300
購入金額: 1055000
儲け: -285700
回収率: 0.7291943127962085
```

<br>

* 2014 年予想

```
RANK_ONE_TWO_HORSE 回数: 167
RANK_ONE_THREE_HORSE 回数: 122
RANK_ONE_FOUR_HORSE 回数: 115
RANK_ONE_FIVE_HORSE 回数: 95
RANK_TWO_THREE_HORSE 回数: 168
RANK_TWO_FOUR_HORSE 回数: 88
RANK_TWO_FIVE_HORSE 回数: 85
RANK_THREE_FOUR_HORSE 回数: 60
RANK_THREE_FIVE_HORSE 回数: 89
RANK_FOUR_FIVE_HORSE 回数: 14
未購入回数: 2448

当たり馬券: 243
はずれ馬券: 760
的中率: 0.24227318045862412

当たり金額: 901500
購入金額: 1003000
儲け: -101500
回収率: 0.8988035892323031
```

<br>

* 2015 年予想

```
RANK_ONE_TWO_HORSE 回数: 192
RANK_ONE_THREE_HORSE 回数: 153
RANK_ONE_FOUR_HORSE 回数: 82
RANK_ONE_FIVE_HORSE 回数: 96
RANK_TWO_THREE_HORSE 回数: 147
RANK_TWO_FOUR_HORSE 回数: 75
RANK_TWO_FIVE_HORSE 回数: 73
RANK_THREE_FOUR_HORSE 回数: 76
RANK_THREE_FIVE_HORSE 回数: 87
RANK_FOUR_FIVE_HORSE 回数: 19
未購入回数: 2454

当たり馬券: 250
はずれ馬券: 750
的中率: 0.25

当たり金額: 951600
購入金額: 1000000
儲け: -48400
回収率: 0.9516
```
