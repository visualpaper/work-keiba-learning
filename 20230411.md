20230411_binary_model_wide

```
    def _observe(self):
        # 1 レースを取得し、observe 化 (20 行固定) する。
        self._race = self._groups[self._steps]
        self._race.reset_index(inplace=True, drop=True)
        # padding_df = self._race.reindex(range(5), fill_value=-1)
        padding_df = self._race[["odds", "pred"]].reindex(range(20), fill_value=-1)
        # print(padding_df.values.tolist())
        return padding_df.values.tolist()


try:
    model = keras.models.load_model('./../model/binary_model_wide')
except:
    print("create")
    # Kerasを使ってモデルを作成します。
    model = keras.models.Sequential([
        keras.layers.Flatten(input_shape=(1,) + env.observation_space.shape),
        keras.layers.Dense(256, activation="elu", kernel_regularizer=keras.regularizers.l2(0.0001)),
        keras.layers.Dense(256, activation='elu', kernel_regularizer=keras.regularizers.l2(0.0001)),
        keras.layers.Dense(256, activation='elu', kernel_regularizer=keras.regularizers.l2(0.0001)),
        keras.layers.Dense(256, activation='elu', kernel_regularizer=keras.regularizers.l2(0.0001)),
        keras.layers.Dropout(0.3),
        keras.layers.Dense(nb_actions, activation="linear"),
    ])

model.summary()

# 経験値を蓄積するためのメモリです。学習を安定させるために使用します。
memory = SequentialMemory(limit=50000, window_length=1)

# 行動ポリシーはBoltzmannQPolicyを使用しています。
# EpsGreedyQPolicyと比較して、こちらの方が収束が早かったので採用しています。
policy = EpsGreedyQPolicy()

# DQNAgentを作成します。
dqn = DQNAgent(
    model=model,
    nb_actions=nb_actions,
    memory=memory,
    target_model_update=1e-2,
    policy=policy)

# DQNAgentのコンパイル。最適化はAdam,評価関数はMAEを使用します。
dqn.compile(Adam(learning_rate=1e-4), metrics=[
    keras.losses.BinaryCrossentropy(from_logits=True, name='binary_crossentropy'), 'accuracy'
])

cp_callback = ModelCheckpoint(model, "./../checkpoint/20230411_binary_model_wide", 10)

# 学習開始
history = dqn.fit(env, nb_steps=30000000, visualize=False, log_interval=34462, callbacks=[cp_callback], verbose=1)



create
Model: "sequential"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 flatten (Flatten)           (None, 40)                0         
                                                                 
 dense (Dense)               (None, 256)               10496     
                                                                 
 dense_1 (Dense)             (None, 256)               65792     
                                                                 
 dense_2 (Dense)             (None, 256)               65792     
                                                                 
 dense_3 (Dense)             (None, 256)               65792     
                                                                 
 dropout (Dropout)           (None, 256)               0         
                                                                 
 dense_4 (Dense)             (None, 4)                 1028      
                                                                 
=================================================================
Total params: 208,900
Trainable params: 208,900
Non-trainable params: 0
_________________________________________________________________

[13594.0, 15016.0, 15008.0, 15032.0, 14946.0, 14908.0, 15034.0, 14898.0, 14796.0, 14944.0, 14960.0, 14838.0, 14964.0, 14846.0, 15028.0, 14868.0, 14978.0, 14868.0, 14896.0, 14930.0, 14996.0, 14962.0, 14980.0, 14814.0, 14820.0, 14914.0, 14860.0, 14806.0, 14970.0, 14802.0, 14802.0, 15030.0, 14864.0, 14956.0, 15068.0, 15096.0, 14988.0, 14876.0, 14742.0, 15222.0, 14990.0, 14912.0, 14878.0, 14626.0, 14842.0, 14832.0, 14896.0, 14878.0, 15002.0, 14902.0, 14994.0, 14990.0, 14862.0, 15082.0, 15104.0, 14920.0, 14868.0, 15002.0, 14968.0, 14954.0, 14870.0, 14938.0, 15020.0, 14846.0, 14954.0, 14982.0, 14890.0, 14882.0, 14898.0, 15004.0, 14886.0, 15070.0, 14766.0, 15044.0, 14956.0, 14866.0, 14972.0, 14914.0, 15048.0, 15100.0, 15036.0, 14942.0, 15052.0, 15044.0, 14938.0, 14958.0, 15130.0, 15078.0, 14942.0, 14952.0, 14730.0, 15004.0, 15134.0, 14966.0, 15076.0, 14974.0, 14984.0, 15146.0, 15216.0, 15094.0, 15030.0, 15016.0, 15218.0, 15188.0, 15096.0, 15136.0, 15166.0, 15172.0, 15204.0, 15124.0, 15058.0, 15068.0, 15142.0, 14976.0, 15200.0, 15370.0, 15146.0, 15212.0, 15222.0, 15340.0, 15132.0, 15290.0, 15272.0, 15182.0, 15310.0, 15196.0, 15074.0, 15436.0, 15228.0, 15110.0, 15424.0, 15142.0, 15192.0, 15204.0, 15282.0, 15448.0, 15028.0, 15422.0, 15340.0, 15204.0, 15284.0, 15266.0, 15488.0, 15258.0, 15502.0, 15180.0, 15342.0, 15522.0, 15458.0, 15498.0, 15490.0, 15330.0, 15584.0, 15322.0, 15848.0, 15498.0, 15534.0, 15546.0, 15422.0, 15568.0, 15728.0, 15610.0, 15702.0, 15776.0, 15682.0, 15708.0, 15786.0, 15688.0, 15540.0, 15586.0, 15788.0, 15744.0, 15766.0, 15774.0, 15680.0, 15752.0, 15744.0, 15696.0, 15724.0, 15744.0, 15876.0, 15768.0, 15722.0, 15866.0, 15750.0, 15940.0, 15868.0, 15906.0, 15860.0, 15868.0, 15876.0, 15994.0, 15876.0, 15906.0, 15956.0, 16222.0, 15800.0, 15968.0, 15938.0, 15924.0, 15976.0, 15896.0, 15994.0, 15822.0, 16032.0, 16108.0, 15884.0, 15898.0, 16064.0, 16004.0, 16052.0, 15956.0, 16100.0, 16120.0, 16016.0, 15892.0, 16012.0, 15932.0, 16250.0, 16176.0, 16144.0, 16214.0, 16082.0, 16238.0, 16180.0, 16146.0, 16012.0, 16320.0, 16206.0, 16264.0, 16156.0, 16300.0, 16400.0, 16400.0, 16542.0, 16268.0, 16200.0, 16508.0, 16432.0, 16582.0, 16496.0, 16528.0, 16426.0, 16502.0, 16616.0, 16508.0, 16530.0, 16318.0, 16558.0, 16524.0, 16578.0, 16602.0, 16628.0, 16722.0, 16510.0, 16712.0, 16664.0, 16746.0, 16628.0, 16646.0, 16764.0, 16646.0, 16778.0, 16816.0, 16768.0, 16850.0, 16846.0, 16744.0, 16824.0, 16960.0, 16740.0, 17250.0, 16962.0, 16998.0, 17036.0, 16996.0, 17178.0, 17068.0, 17006.0, 17190.0, 17210.0, 17146.0, 17206.0, 17124.0, 17180.0, 17296.0, 17214.0, 17398.0, 17436.0, 17492.0, 17376.0, 17382.0, 17368.0, 17510.0, 17472.0, 17528.0, 17554.0, 17482.0, 17582.0, 17582.0, 17790.0, 17676.0, 17790.0, 17702.0, 17744.0, 17760.0, 17910.0, 17912.0, 17924.0, 17936.0, 17988.0, 17894.0, 17984.0, 17676.0, 17752.0, 17848.0, 18030.0, 17848.0, 17920.0, 18274.0, 18014.0, 18146.0, 18078.0, 18164.0, 17834.0, 18174.0, 18126.0, 18638.0, 18332.0, 18412.0, 18394.0, 18376.0, 18444.0, 18552.0, 18402.0, 18424.0, 18328.0, 18660.0, 18632.0, 18708.0, 18450.0, 18664.0, 18508.0, 18522.0, 18706.0, 18630.0, 18706.0, 18644.0, 18546.0, 18758.0, 18870.0, 18590.0, 18828.0, 18736.0, 18870.0, 18812.0, 18810.0, 18826.0, 18926.0, 19018.0, 18946.0, 18928.0, 19010.0, 18768.0, 18868.0, 19140.0, 18996.0, 19014.0, 19048.0, 19204.0, 19062.0, 19118.0, 19038.0, 19028.0, 19414.0, 19150.0, 19128.0, 19154.0, 19132.0, 19438.0, 19140.0, 19164.0, 19116.0, 19380.0, 19484.0, 19442.0, 19630.0, 19554.0, 19582.0, 19466.0, 19566.0, 19642.0, 19588.0, 19414.0, 19510.0, 19648.0, 19830.0, 19776.0, 19650.0, 19736.0, 19642.0, 19752.0, 19750.0, 19930.0, 19850.0, 19870.0, 19824.0, 19908.0, 19942.0, 19928.0, 19828.0, 19956.0, 19966.0, 20174.0, 20308.0, 19906.0, 20124.0, 20174.0, 19990.0, 20036.0, 20094.0, 20314.0, 20162.0, 20458.0, 20164.0, 20344.0, 20410.0, 20312.0, 20160.0, 20224.0, 20216.0, 20392.0, 20374.0, 20236.0, 20284.0, 20324.0, 20564.0, 20366.0, 20570.0, 20436.0, 20530.0, 20610.0, 20482.0, 20516.0, 20544.0, 20788.0, 20646.0, 20900.0, 20758.0, 20590.0, 20574.0, 20820.0, 20590.0, 20908.0, 20916.0, 20766.0, 20896.0, 20828.0, 21114.0, 20686.0, 20684.0, 20786.0, 21002.0, 20706.0, 20930.0, 20870.0, 21020.0, 21094.0, 20978.0, 20930.0, 20930.0, 20992.0, 20902.0, 21160.0, 21042.0, 21318.0, 20894.0, 20900.0, 20996.0, 21104.0, 21004.0, 21012.0, 21278.0, 20986.0, 21140.0, 21132.0, 21080.0, 21228.0, 21148.0, 21258.0, 21202.0, 21158.0, 21200.0, 21176.0, 21258.0, 21446.0, 21072.0, 21326.0, 21332.0, 21284.0, 21348.0, 21080.0, 21372.0, 21282.0, 21414.0, 21202.0, 21406.0, 21224.0, 21478.0, 21584.0, 21402.0, 21386.0, 21460.0, 21302.0, 21452.0, 21436.0, 21370.0, 21288.0, 21454.0, 21510.0, 21486.0, 21698.0, 21586.0, 21374.0, 21378.0, 21472.0, 21712.0, 21476.0, 21430.0, 21458.0, 21592.0, 21490.0, 21514.0, 21588.0, 21280.0, 21516.0, 21560.0, 21536.0, 21556.0, 21528.0, 21764.0, 21574.0, 21676.0, 21592.0, 21642.0, 21508.0, 21808.0, 21528.0, 21628.0, 21536.0, 21772.0, 21672.0, 21810.0, 21744.0, 21796.0, 21706.0, 21492.0, 21776.0, 21742.0, 21682.0, 21944.0, 21742.0, 21834.0, 21502.0, 21756.0, 21712.0, 21882.0, 21972.0, 21740.0, 21900.0, 21594.0, 21906.0, 21846.0, 21872.0, 21812.0, 21996.0, 21992.0, 21618.0, 21798.0, 22252.0, 21928.0, 21912.0, 22004.0, 21870.0, 21974.0, 21932.0, 22094.0, 22020.0, 21922.0, 21896.0, 21950.0, 21988.0, 21862.0, 21868.0, 21908.0, 21996.0, 22050.0, 21862.0, 21998.0, 22050.0, 22018.0, 22008.0, 22054.0, 22010.0, 22158.0, 21992.0, 22048.0, 21964.0, 21984.0, 22094.0, 22146.0, 21960.0, 21974.0, 22168.0, 21984.0, 22172.0, 21906.0, 22060.0, 22076.0, 21886.0, 21906.0, 22196.0, 22078.0, 22186.0, 22032.0, 22168.0, 22226.0, 22208.0, 22160.0, 22280.0, 22240.0, 22378.0, 22214.0, 22334.0, 22142.0, 22204.0, 22134.0, 22158.0, 22198.0, 22436.0, 22458.0, 22116.0, 22206.0, 22180.0, 22282.0, 22062.0, 22280.0, 22056.0, 22266.0, 22250.0, 22250.0, 22462.0, 22266.0, 22280.0, 22288.0, 22300.0, 22194.0, 22258.0, 22074.0, 22324.0, 22328.0, 22076.0, 22272.0, 22114.0, 22160.0, 22368.0, 22138.0, 22362.0, 22254.0, 22266.0, 22252.0, 22162.0, 22166.0, 22034.0, 22266.0, 22178.0, 22424.0, 22098.0, 22320.0, 21868.0, 22266.0, 22360.0, 22202.0, 21952.0, 22176.0, 22396.0, 22324.0, 22300.0, 22152.0, 22434.0, 22450.0, 22166.0, 22326.0, 22518.0, 22290.0, 22248.0, 22318.0, 22092.0, 22182.0, 22244.0, 22462.0, 22366.0, 22354.0, 22404.0, 22454.0, 22278.0, 22072.0, 22494.0, 22250.0, 22176.0, 22334.0, 22126.0, 22072.0, 22356.0, 22438.0, 22428.0, 22260.0, 22288.0, 22376.0, 22600.0, 22162.0, 22236.0, 22296.0, 22206.0, 22298.0, 22170.0, 22238.0, 22410.0, 22278.0, 22326.0, 22438.0, 22464.0, 22226.0, 22268.0, 22472.0, 22358.0, 22420.0, 22246.0, 22450.0, 22584.0, 22182.0, 22416.0, 22330.0, 22424.0, 22324.0, 22126.0, 22354.0, 22374.0, 22356.0, 22472.0, 22136.0, 22472.0, 22082.0, 22304.0, 22152.0, 22356.0, 22400.0, 22400.0, 22258.0, 22408.0, 22190.0, 22306.0, 22304.0, 22328.0, 22232.0, 22206.0, 22466.0, 22222.0, 22410.0, 22290.0, 22364.0, 22524.0, 22176.0, 22280.0, 22356.0, 22496.0, 22292.0, 22640.0, 22326.0, 22168.0, 22260.0, 22366.0, 22482.0, 22354.0, 22328.0, 22422.0, 22170.0, 22512.0, 22352.0, 22396.0, 22274.0, 22208.0, 22550.0, 22492.0, 22170.0, 22364.0, 22254.0, 22180.0, 22438.0, 22108.0, 22238.0, 22242.0, 22334.0, 22334.0, 22178.0, 22242.0, 22270.0, 22368.0, 22492.0, 22222.0, 22402.0, 22412.0, 22368.0, 22370.0, 22442.0, 22138.0, 22092.0, 22152.0, 22170.0, 22296.0, 22348.0, 22080.0, 22364.0, 22092.0, 22312.0, 22220.0, 22388.0, 22386.0, 22400.0, 22218.0, 22276.0, 22330.0, 22274.0, 22330.0, 22408.0, 22360.0, 22294.0, 22146.0, 22472.0, 22306.0, 22450.0, 22188.0, 22326.0, 22332.0, 22460.0, 22300.0, 22398.0, 22204.0, 22658.0, 22336.0, 22422.0, 22514.0, 22220.0, 22484.0, 22460.0, 22482.0, 22268.0, 22230.0, 22350.0, 22424.0, 22464.0, 22254.0, 22398.0, 22462.0, 22394.0, 22238.0, 22316.0, 22402.0, 22426.0, 22170.0]
```

<br><br>

100% 超えるのは難しい。
